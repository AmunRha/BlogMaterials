#include <stdio.h>
#include <Windows.h>
#include <exception>

#define CALL_FIRST 1

LONG WINAPI myHandler(
    struct _EXCEPTION_POINTERS* ExceptionInfo
) {
    if (ExceptionInfo->ExceptionRecord->ExceptionCode == STATUS_INTEGER_DIVIDE_BY_ZERO || ExceptionInfo->ExceptionRecord->ExceptionCode == STATUS_FLOAT_DIVIDE_BY_ZERO) {
        PCONTEXT ctx = ExceptionInfo->ContextRecord;
        if (ctx->Dr0 || ctx->Dr1 || ctx->Dr2 || ctx->Dr3) {
            printf("Hardware Breakpoint is set. Process Exiting");
            exit(0);
        }
    }
    return EXCEPTION_CONTINUE_EXECUTION;
}

int main()
{
    PVOID h1 = AddVectoredExceptionHandler(CALL_FIRST, myHandler);
    int inp1 = 0, inp2 = 0;
    int result = inp1 / inp2;
    RemoveVectoredExceptionHandler(h1);
    return 0;
}
